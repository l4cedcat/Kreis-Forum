<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kreis Forum BK (edit)</title>
  <style>
    body {
      font-family: monospace;
      background: #7e7f81;
      color: #2f2f2f;
      padding: 20px;
    }
    h1 {
      color: rgb(68, 72, 81);
    }
    #greetingPage {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: #e4e4e4;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      text-align: center;
    }
    #greetingPage p {
      font-size: 1.1em;
      margin-bottom: 15px;
    }
    #enterForumBtn {
      padding: 12px 20px;
      font-size: 1.1em;
      background: #555;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #forum {
      border: 1px solid #d0d0d0;
      padding: 10px;
      max-width: 600px;
      margin: auto;
      background: #e4e4e4;
      display: none; /* Hide forum initially */
    }
    .message {
      border-bottom: 1px dashed #444;
      margin-bottom: 10px;
      padding-bottom: 5px;
    }
    .meta {
      font-size: 0.9em;
      color: #7d7d7d;
    }
    input, textarea, button {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 10px;
      padding: 8px;
      background: #cdcdcd;
      color: #6d6d6d;
      border: 1px solid #666;
      border-radius: 4px;
      font-family: monospace;
    }
    /* Smaller delete buttons inside messages */
    .delete-btn {
      float: right;
      background: #a33;
      color: white;
      border: none;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8em;
      cursor: pointer;
    }
    #clearBtn {
      background: #555;
      color: white;
      display: none;
      margin-top: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- GREETING PAGE -->
  <div id="greetingPage">
    <h1>Wilkommen zum Kreis Forum!!</h1>
    <p>●Forum erstellt von mila E. (admin)</p>
    <p>●geb einen namen ein & schreib etwas</p>
    <p>●admins können das Forum löschen und Nachrichten moderieren</p>
    <button id="enterForumBtn">Enter Forum</button>
  </div>

  <!-- FORUM PAGE -->
  <div id="forum">
    <h1>Kreis Forum</h1>
    <input id="name" placeholder="dein name/ nickname" />
    <textarea id="message" placeholder="type ur message here..." rows="4"></textarea>
    <button onclick="postMessage()">Post</button>
    <button id="clearBtn" onclick="clearForum()">Clear Forum</button>

    <div id="messages"></div>
  </div>

  <script>
    const adminUsers = ["mila"]; // Your admin usernames here

    const greetingPage = document.getElementById("greetingPage");
    const forum = document.getElementById("forum");
    const enterForumBtn = document.getElementById("enterForumBtn");
    const messagesDiv = document.getElementById("messages");

    enterForumBtn.addEventListener("click", () => {
      greetingPage.style.display = "none";
      forum.style.display = "block";
      updateAdminTools();
      loadMessages();
    });

    function loadMessages() {
      const messages = JSON.parse(localStorage.getItem("forumMessages") || "[]");
      const currentUser = localStorage.getItem("forumUser");
      messagesDiv.innerHTML = "";

      messages.forEach((msg, index) => {
        const div = document.createElement("div");
        div.className = "message";

        let html = `<div class="meta"><strong>${msg.name}</strong> @ ${msg.time}`;

        // Show delete button if message is from current user OR if current user is admin
        if (msg.name === currentUser || adminUsers.includes(currentUser)) {
          html += ` <button class="delete-btn" onclick="deleteMessage(${index})">Delete</button>`;
        }

        html += `</div><div>${msg.text}</div>`;
        div.innerHTML = html;
        messagesDiv.appendChild(div);
      });
    }

    function postMessage() {
      const name = document.getElementById("name").value.trim();
      const text = document.getElementById("message").value.trim();
      if (!name || !text) return alert("Enter both name and message!");

      localStorage.setItem("forumUser", name); // Save username when posting

      const time = new Date().toLocaleString();
      const newMessage = { name, text, time };

      const messages = JSON.parse(localStorage.getItem("forumMessages") || "[]");
      messages.push(newMessage);
      localStorage.setItem("forumMessages", JSON.stringify(messages));

      document.getElementById("message").value = "";
      loadMessages();
      updateAdminTools();
    }

    function deleteMessage(index) {
      const messages = JSON.parse(localStorage.getItem("forumMessages") || "[]");
      messages.splice(index, 1);
      localStorage.setItem("forumMessages", JSON.stringify(messages));
      loadMessages();
    }

    function clearForum() {
      const confirmed = confirm("Are you sure you want to delete all messages? :<");
      if (confirmed) {
        localStorage.removeItem("forumMessages");
        loadMessages();
      }
    }

    function updateAdminTools() {
      const currentUser = localStorage.getItem("forumUser");
      const clearBtn = document.getElementById("clearBtn");
      if (adminUsers.includes(currentUser)) {
        clearBtn.style.display = "block";
      } else {
        clearBtn.style.display = "none";
      }
    }

    // Load name on forum page show
    document.getElementById("name").value = localStorage.getItem("forumUser") || "";

    // Save name as user types and update UI
    document.getElementById("name").addEventListener("input", () => {
      localStorage.setItem("forumUser", document.getElementById("name").value.trim());
      loadMessages();
      updateAdminTools();
    });

  </script>
</body>
</html>
